---
- hosts: all
  become: yes
  become_method: sudo

  # Set variables for a local copy of the API server
  vars:
    opnf_env_name: LOCAL
    opnf_env_color: 32

  # Install our custom roles
  roles:
    - open-notify-server        # 'server' role is basic setup. Users/groups/ssh/apt/security
    - open-notify-webserver     # 'webserver' role installs and configures nginx
    - open-notify-redis         # Install redis server
    - open-notify-datadog       # Datadog monitor
    - open-notify-apiservice    # 'apiservice' role sets up for the actual API code to run (python, uwsgi, etc)

  tasks:

    - name: Add some help notes to the home directory
      copy:
        content: |
          Help
          ----

          sudo systemctl reload nginx
          follow nginx
          tail-nginx
          sudo systemctl enable open-notify-api
          start open-notify-api
          upgrade
          sudo tail -F /var/log/uwsgi/open-notify-api-uwsgi.log
        dest: /home/deploy/help.txt
        owner: deploy
        group: deploy
