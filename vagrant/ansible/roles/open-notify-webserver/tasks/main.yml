---
- name: Update Apt
  apt: update_cache=yes

- name: Install Basic Packages
  apt: name={{ item }} state=present
  with_items:
    - vim
    - tmux
    - curl
    - ntp
    - build-essential

- name: Make 'sudo' Group
  group:
   name: sudo
   state: present

- name: Allow Password-less 'sudo'
  lineinfile:
    dest: /etc/sudoers
    state: present
    regexp: '^%sudo'
    line: '%sudo ALL=(ALL) NOPASSWD: ALL'

- name: Create User 'deploy'
  user:
    name: deploy
    state: present
    groups: sudo
    append: yes
    createhome: yes
    shell: /bin/bash

- name: Set 'deploy' User Authorized Key From Current User
  authorized_key:
    user: deploy
    state: present
    key: "{{ lookup('pipe', 'ssh-add -L') }}"

- name: User 'deploy' Set '.vimrc'
  copy:
    content: |
        set number
        set wrap
        set linebreak
        set nolist
        set breakindent
        set textwidth=0
        set wrapmargin=0
        syn on
        set hlsearch
        set cul
        set tabstop=4
        set shiftwidth=4
        set expandtab
    dest: /home/deploy/.vimrc
    owner: deploy
    group: deploy

- name: User 'deploy' set bashrc alias 'll'
  lineinfile:
    dest: /home/deploy/.bashrc
    state: present
    regexp: "^#alias ll="
    line: "alias ll='ls -l'"

- name: User 'deploy' set bashrc color term
  lineinfile:
    dest: /home/deploy/.bashrc
    state: present
    regexp: "^#force_color_prompt="
    line: "force_color_prompt=yes"

- name: Static Site Directory
  file:
    path: /opt/web/static/
    state: directory
    owner: www-data
    group: www-data
    mode: 0555
    recurse: yes

- name: Dummy index.html file
  copy:
    content: "open-notify.org"
    dest: /opt/web/static/index.html
    owner: www-data
    group: www-data
    mode: 0444
    force: no
